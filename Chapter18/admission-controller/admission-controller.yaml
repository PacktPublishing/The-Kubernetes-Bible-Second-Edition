# admission-controller.yaml
---
apiVersion: v1
kind: Namespace
metadata:
  name: admission-controllers

---
apiVersion: v1
kind: Secret
metadata:
  name: admission-controller-secret
  namespace: admission-controllers
type: kubernetes.io/tls
data:
  # The following fields need to be base64 encoded
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURqekNDQW5lZ0F3SUJBZ0lVY0JzR0tlVXh5K3NwMzdPWjFPcTRkc3pmUlVBd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0dqRVlNQllHQTFVRUF3d1BiWGt0WVdSdGFYTnphVzl1TFdOaE1CNFhEVEkwTVRBeU5qRTVNVGt3T1ZvWApEVEkxTVRBeU5qRTVNVGt3T1Zvd2dhUXhDekFKQmdOVkJBWVRBbE5ITVJJd0VBWURWUVFJREFsVGFXNW5ZWEJ2CmNtVXhFakFRQmdOVkJBY01DVk5wYm1kaGNHOXlaVEVZTUJZR0ExVUVDZ3dQVFhrZ1QzSm5ZVzVwZW1GMGFXOXUKTVJZd0ZBWURWUVFMREExSlZDQkVaWEJoY25SdFpXNTBNVHN3T1FZRFZRUUREREpoWkcxcGMzTnBiMjR0WTI5dQpkSEp2Ykd4bGNpMXpkbU11WVdSdGFYTnphVzl1TFdOdmJuUnliMnhzWlhKekxuTjJZekNDQVNJd0RRWUpLb1pJCmh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTXNyRWZPTjB1OGptcUdGRlRkQmlhUUVtdWgzVDlWb202OUwKVFB3REkvSkxBNXpnN1NRcWNzMGFmRU11dWVVT3JyTWZPdWFWSUllektTL1NuWXV6ZnpHeEZNdTdCUHJDejFiYQpTQVFKRWxMd2lHekJaVFlKN3kxUVZDYzVzMFNybnhXRE1iSE8xWUVTNm5KZ2s0MXIzSDIvL0FITFZxSmJXeFFsCmRyNUNLRFdpVnZRcnYwSlIxVk4yMDFndEdTY0t0cUNmdlJDRlEvTDcvOWFpQlRsSkRtQVE0Uy9YTzUzZFBGWkQKUjJZVkdEUmNRcVF6ZWFFdk93SE5LWEhxRklSenRYVC9xbkdiaGlVYVgrcERpVlEwNmxRYllvbmFUSlRDWGVobwp1VlJXMVhGYjE3ZFpXa2FqWnd6WHE0c1h4cUhYKytvVTQzZVN6TW1iUTQxU25YZFpIQ0VDQXdFQUFhTkNNRUF3CkhRWURWUjBPQkJZRUZIUEZHZGdvM0lVWTRYMDV3M2s5aVdZUXF6S21NQjhHQTFVZEl3UVlNQmFBRkN3a3BEYkcKdTYyV0JESUYzcUh4QXdOL2cxcWFNQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUJBUUIvTnplTllxTmtvM0lId2VYVgpBZDQzUHZKUDdMaHpUR0luSGdNVTF3ajEyK1psdytFVy9lbFhPb1Z4SzBHeEZvZTZqYnlOQXliZlJTVStMdEVSCkFMYjVLeGIzVGR2NjQ2T3Vic0JDWUxIWHhYVW55ZzRxeHQ3QW0yRmtTdE45cG9tQ0xoaFoxaXJ3YTc2VTN3VVYKVHUrMVVINzd2UVZMb0JucjZJaEFRcng5SEU2YjZrZHcrUkZKeWRmTG9oVGhUZEQwQ0x5MzZ0WXE2OWF3OFE3YwovT0V4NHZ4V0xROVlSQnMzaFZLVGR4SytNcXVjZjkwRUJNR05TNmMzTk9HQ3NnOFkvVkVGcmlsNEFPbUxiNXJMCmxRYlBCQVhuWXlFVk1UN3Z5ajc5RFNudkZhNkpaanJJaCtQT2lMUU9JcGZzUlFzck9MNm84U0h1OGlTanVSS0EKOTMySgotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2UUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktjd2dnU2pBZ0VBQW9JQkFRRExLeEh6amRMdkk1cWgKaFJVM1FZbWtCSnJvZDAvVmFKdXZTMHo4QXlQeVN3T2M0TzBrS25MTkdueERMcm5sRHE2ekh6cm1sU0NIc3lrdgowcDJMczM4eHNSVEx1d1Q2d3M5VzJrZ0VDUkpTOEloc3dXVTJDZTh0VUZRbk9iTkVxNThWZ3pHeHp0V0JFdXB5CllKT05hOXg5di93QnkxYWlXMXNVSlhhK1FpZzFvbGIwSzc5Q1VkVlRkdE5ZTFJrbkNyYWduNzBRaFVQeSsvL1cKb2dVNVNRNWdFT0V2MXp1ZDNUeFdRMGRtRlJnMFhFS2tNM21oTHpzQnpTbHg2aFNFYzdWMC82cHhtNFlsR2wvcQpRNGxVTk9wVUcyS0oya3lVd2wzb2FMbFVWdFZ4VzllM1dWcEdvMmNNMTZ1TEY4YWgxL3ZxRk9OM2tzekptME9OClVwMTNXUndoQWdNQkFBRUNnZ0VBRnhlNml2K05NTjJRQlVrb1RjOHJGd3VuZEdJZ1hzSk14TlpYSmlOd3ZlanAKSEpjajJUc2ljSjN3cngyejV6MWRuZEpBU29aN2k3VVJhc1JDb0VjTEgzR3dhbzVEdlFGdzJmOUdWWUFXOXpxcwpGUWwvNks0bEk1WklkR3R1YlJFaFRFdU0xZGdyeENlcllvd0g1WGlUdDY3ZlZQQmc5T1FUcElUMEcrRE82M2FICitZZnBKQUZEUVhYbHlxK0g1M3IxajJBS2ZJNEs0WkNWUjVGT2hJTkZSdnM3QVF3a3g0eFlLdHFkU1NMZHQyY3oKdEhGWWZnM3l3ZkwwdE1UZ2k1SHNkT3RPZ29HcE1WRjV0cVVtdEF2Nk1Ib2pmZU5NTFNINkVmZ3hvdXUwdnFOWgpvWW5aUGlYUkdlZ3FaVHhrbUhmUHFQWCtBVEdrWkFpb0lLOWtGbDQ1R1FLQmdRRDBnR05UaTVxaGViUWpHbDdlClVuSTlMZVcvNmpQZ0lRZGhKQXlEVG1JNG9jMXJheGkvcmlyTjJMeWRxcTgvYzZDdnIwRWRNS1NWM1JDTElRa3cKWmJ4YjFSZmRVdFBZaDd1b3JRMEFubnZhcDA2U2UvejVaTUttelNrWlRzNmhidTQwT254dTdwaVRPYXpMSTU1RApSMjdaYVphOVd3cGl0ZTJnVFhSRnRPQk4yUUtCZ1FEVXVRK2VLNzdOTEZWaHJsL3NYT1N5bzc0VU5NNkRCRk02ClBscU1oWVBhbDlaV3BQcm9BeUNCRlppeldzZXB1TUlabDB6Nm8vSitmQm9Uc3lBQXZIV1VrN3dvaGpSS2NsNFQKR2MyVWJTSitZa0NTcUZja3FwTVFJNDFGdnQ4V3VNUExieG1UTlB5SkMxeEFNeVJPcVVvSWRLZ3B2VU9XblRHcAo3QWtFUHB3cmlRS0JnQU5jaElFUWlVYXhDcVgwNWRyK25TMTBKUlYzWGRFMkF3ajEydW92T0xCNG9QOWFFSlFLCkMvS2FpVFZOdEcwVjVONmxkU3Eya1h5eDlsbERVZ0lGVkFxYkttSFRrckFHWmJFUzkvdkxNZjYya0NENWJXZnMKVjdTOVcxUkt2aEtBR094RTVaTU0ycklqZDltdkdxem9IWUVGcjVuWTE1SzExNWQ5bVJ5Z09QazVBb0dCQUljTQp3bXlScXozSkFwL1VPOVBzbWNrTUNaWDhmSXRUU0o5MmpMZ2YzN2o4b3JnNVg0M0N4blVOUi9lK0QzcWg4S0NjCm5PT1hDRkhpNmc5TnJtaXBQU0RKdGpBb0c3U1Q3VVBGSXU0elp5M0RwT2syOUxRemt0QXhNZlJ3bkdOcGcreDQKcVV6NjI4VUpzRlNWNDF3SlFCWWtNY3JsL0szM09GdC9uYTNUTGdTNUFvR0FPTUw1NVo5Y202RGpJY0s3aWRHVworL1lwTFJqSXpYR1FFNXBHR0REb0s5YWlVRE5SY0ROU3pYMW9JZ2ZyQWVvTG1Kc0JzY0JNVXlaUWM4MDc5cFN0CldBU0JKMU5za0JqeVlyN29TSVdhbVNxeHhUdGhDTzdCdnRrZ3lNMXorNUFSWTdRWGRtN2FlQ3U5T2Q4dTdOTU0KdGc1OFNmazYwT3FpYmtNb0NkRFRwZW89Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: admission-controller
  namespace: admission-controllers
spec:
  replicas: 1
  selector:
    matchLabels:
      app: admission-controller
  template:
    metadata:
      labels:
        app: admission-controller
    spec:
      containers:
        - name: admission-controller
          image: quay.io/iamgini/k8s-admission-controller:1.5
          ports:
          - containerPort: 443
          resources:
            limits:
              memory: "128Mi"
              cpu: "100m"
            requests:
              memory: "64Mi"
              cpu: "50m"
          volumeMounts:
            - name: certs
              mountPath: /app/certs
      volumes:
        - name: certs
          secret:
            secretName: admission-controller-secret
---
apiVersion: v1
kind: Service
metadata:
  name: admission-controller-svc
  namespace: admission-controllers
spec:
  ports:
    - port: 443
      targetPort: 443
  selector:
    app: admission-controller
